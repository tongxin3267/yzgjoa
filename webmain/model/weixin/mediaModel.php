<?php
class weixin_mediaClassModel extends weixinModel { public function upload($file, $type='') { $token = $this->gettoken(); if($type=='')$type = 'image'; $url = ''.$this->gettourl('URL_mediaupload').'?access_token='.$token.'&type='.$type.''; $data = array('media'=>'@'.ROOT_PATH.'/'.$file); $result = c('curl')->postcurl($url, $data, 1); $barr = $this->backarr; $barr['msg']= '上传出错'; if($result != ''){ $arr = json_decode($result, true); if(isset($arr['errmsg'])){ $barr['errcode'] = $arr['errcode']; $barr['msg'] = $arr['errmsg']; }else{ $barr = $arr; $barr['errcode'] = 0; $barr['msg'] = 'ok'; } } return $barr; } }